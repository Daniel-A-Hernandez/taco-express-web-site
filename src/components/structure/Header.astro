---
import { Image } from 'astro:assets';
import logo from '@/assets/logo-tacoexpress.png';
import Navbar from '@/components/structure/Navbar';
---

<header class="sticky top-0 z-40 bg-white shadow-md border-b border-orange-100">
  <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
    
    <div class="flex items-center space-x-3">
      <div class="relative w-12 h-12 sm:w-15 sm:h-15 flex-shrink-0">
        <Image
          src={logo}
          alt="Logo Taco Express"
          class="w-full h-full object-contain"
          loading="eager"
        />
      </div>

      <div>
        <h1 class="font- text-lg sm:text-xl font-black italic uppercase text-stone-900 leading-none tracking-tighter">
          Taco <span class="text-[#f29829]">Express</span>
        </h1>

        <div class="flex items-center text-[9px] sm:text-[10px] font-bold uppercase tracking-widest mt-1">
          <span
            id="indicador-dot"
            class="w-2.5 h-2.5 mr-2 rounded-full bg-gray-300 transition-colors duration-500"
          ></span>
          <span id="indicador-text" class="text-stone-500">Cargando…</span>
        </div>
      </div>
    </div>

    <div class="flex items-center">
        <Navbar client:only="preact" />
    </div>

  </div>
</header>

<script>
  function actualizarEstado() {
    const now = new Date();
    // Ajuste para horario de El Salvador (UTC-6)
    const svTime = new Date(now.toLocaleString("en-US", {timeZone: "America/El_Salvador"}));
    
    const hours = svTime.getHours();
    const dayName = new Intl.DateTimeFormat('es-ES', { weekday: 'long' }).format(svTime).toLowerCase();

    const dot = document.getElementById('indicador-dot');
    const text = document.getElementById('indicador-text');

    if (!dot || !text) return;

    // Lógica: Cerrado lunes, o antes de las 2 PM (14h), o después de las 10 PM (22h)
    const estaCerrado = dayName === 'lunes' || hours < 14 || hours >= 22;

    if (estaCerrado) {
      dot.classList.remove('bg-green-500', 'bg-gray-300');
      dot.classList.add('bg-red-500', 'animate-pulse');
      text.textContent = 'Cerrado';
      text.classList.add('text-red-600');
    } else {
      dot.classList.remove('bg-red-500', 'bg-gray-300');
      dot.classList.add('bg-green-500', 'animate-pulse');
      text.textContent = 'Abierto ahora';
      text.classList.add('text-green-600');
    }
  }

  // Ejecutar al cargar y cada minuto
  actualizarEstado();
  setInterval(actualizarEstado, 60000);
</script>